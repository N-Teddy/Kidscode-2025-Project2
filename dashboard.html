<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - My Personal Expense Advisor</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @keyframes bounce-gentle {

            0%,
            100% {
                transform: translateY(0);
            }

            50% {
                transform: translateY(-10px);
            }
        }

        @keyframes fade-in {
            from {
                opacity: 0;
                transform: translateY(30px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .animate-bounce-gentle {
            animation: bounce-gentle 2s infinite;
        }

        .animate-fade-in {
            animation: fade-in 1s ease-out;
        }

        .animate-fade-in-delay {
            animation: fade-in 1s ease-out 0.3s both;
        }
    </style>
</head>

<body class="bg-gradient-to-br from-blue-100 via-purple-50 to-pink-100 min-h-screen">
    <!-- Navigation Header -->
    <nav class="bg-white shadow-lg sticky top-0 z-50">
        <div class="container mx-auto px-4 py-4">
            <div class="flex justify-between items-center">
                <div class="flex items-center space-x-3">
                    <div
                        class="w-10 h-10 bg-gradient-to-r from-purple-500 to-pink-500 rounded-xl flex items-center justify-center shadow-lg">
                        <span class="text-white text-xl font-bold">💰</span>
                    </div>
                    <div>
                        <h1 class="text-xl font-bold text-gray-800">MoneyMate</h1>
                        <p class="text-xs text-gray-500">Your Financial Friend</p>
                    </div>
                </div>
                <div class="flex space-x-2">
                    <a href="dashboard.html"
                        class="bg-purple-100 hover:bg-purple-200 text-purple-700 px-4 py-2 rounded-lg font-semibold transition-all duration-300 flex items-center space-x-1">
                        <span>📊</span><span class="hidden sm:inline">Dashboard</span>
                    </a>
                    <a href="savings-plan.html"
                        class="bg-green-100 hover:bg-green-200 text-green-700 px-4 py-2 rounded-lg font-semibold transition-all duration-300 flex items-center space-x-1">
                        <span>🎯</span><span class="hidden sm:inline">Savings Plan</span>
                    </a>
                    <a href="history.html"
                        class="bg-blue-100 hover:bg-blue-200 text-blue-700 px-4 py-2 rounded-lg font-semibold transition-all duration-300 flex items-center space-x-1">
                        <span>📈</span><span class="hidden sm:inline">History</span>
                    </a>
                    <button id="logoutBtn"
                        class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg font-semibold transition-all duration-300 flex items-center space-x-1">
                        <span>🚪</span><span class="hidden sm:inline">Logout</span>
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <div class="container mx-auto px-4 py-8">
        <!-- Welcome Message -->
        <div class="bg-white rounded-3xl shadow-xl p-6 mb-8 text-center animate-fade-in">
            <h1
                class="text-3xl md:text-4xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-purple-600 to-pink-600 mb-4">
                Welcome back, <span id="usernameDisplay">Hero</span>! 🌟
            </h1>
            <p class="text-gray-600 text-lg">Ready to manage your finances like a superhero? Let's get started!</p>
        </div>

        <!-- Budget Overview Section -->
        <div class="grid md:grid-cols-3 gap-6 mb-8 animate-fade-in-delay">
            <!-- Total Income -->
            <div id="incomeBox" class="bg-gradient-to-br from-green-100 to-green-200 p-6 rounded-xl shadow-lg">
                <div class="flex items-center justify-between">
                    <div>
                        <h3 class="text-lg font-bold text-green-800">💰 Total Income</h3>
                        <p class="text-2xl font-bold text-green-900" id="totalIncome">0 XAF</p>
                    </div>
                    <div class="text-4xl">💵</div>
                </div>
            </div>

            <!-- Total Compulsory Expenses -->
            <div id="compulsoryBox" class="bg-gradient-to-br from-blue-100 to-blue-200 p-6 rounded-xl shadow-lg">
                <div class="flex items-center justify-between">
                    <div>
                        <h3 class="text-lg font-bold text-blue-800">🏠 Compulsory Expenses</h3>
                        <p class="text-2xl font-bold text-blue-900" id="totalCompulsory">0 XAF</p>
                    </div>
                    <div class="text-4xl">🏠</div>
                </div>
            </div>

            <!-- Total Flexible Expenses -->
            <div id="flexibleBox" class="bg-gradient-to-br from-yellow-100 to-yellow-200 p-6 rounded-xl shadow-lg">
                <div class="flex items-center justify-between">
                    <div>
                        <h3 class="text-lg font-bold text-yellow-800">🛍️ Flexible Expenses</h3>
                        <p class="text-2xl font-bold text-yellow-900" id="totalFlexible">0 XAF</p>
                    </div>
                    <div class="text-4xl">🛒</div>
                </div>
            </div>
        </div>

        <!-- Financial Tip of the Day -->
        <div class="bg-gradient-to-r from-purple-100 to-pink-100 p-6 rounded-xl shadow-lg mb-8 animate-fade-in-delay">
            <h3 class="text-xl font-bold text-purple-800 mb-3">💡 Financial Tip of the Day</h3>
            <p class="text-purple-700 text-lg" id="dailyTip">Loading your daily tip...</p>
        </div>

        <!-- Financial Data Input Form -->
        <div class="bg-white rounded-3xl shadow-xl p-8 mb-8 animate-fade-in-delay relative overflow-visible">
            <!-- Background Image -->
            <div class="absolute top-0 right-0 w-48 h-48 opacity-10 pointer-events-none">
                <img src="https://storage.googleapis.com/workspace-0f70711f-8b4e-4d94-86f1-2a93ccde5887/image/24daa167-04c0-43ae-8d9c-f0b2d853c789.png"
                    alt="Cartoon character with calculator and charts, colorful financial planning illustration, child-friendly style"
                    class="w-full h-full object-contain" />
            </div>

            <div class="relative z-10">
                <h2 class="text-2xl md:text-3xl font-bold text-gray-800 mb-6 text-center">📊 Set Up Your Budget</h2>
            </div>

            <form id="budgetForm" class="space-y-6 relative z-10">
                <!-- Monthly Revenue -->
                <div>
                    <label for="monthlyRevenue" class="block text-lg font-bold text-gray-700 mb-2">
                        💰 Monthly Revenue (XAF)
                    </label>
                    <input type="number" id="monthlyRevenue" name="monthlyRevenue" min="0" required
                        class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-purple-500 focus:ring-2 focus:ring-purple-200 transition-all duration-300 text-lg">
                </div>

                <h3 class="text-xl font-bold text-gray-800 mt-8 mb-4">📋 Monthly Expenses</h3>

                <!-- Fixed Expenses -->
                <div class="bg-blue-50 p-6 rounded-lg overflow-visible">
                    <h4 class="text-lg font-bold text-blue-800 mb-4">🏠 Fixed Expenses</h4>
                    <div>
                        <label for="rent" class="block text-sm font-bold text-gray-700 mb-2">
                            🏠 Rent (XAF)
                        </label>
                        <input type="number" id="rent" name="rent" min="0" required
                            class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition-all duration-300">
                    </div>
                </div>

                <!-- Flexible Expenses -->
                <div class="bg-yellow-50 p-6 rounded-lg overflow-visible">
                    <h4 class="text-lg font-bold text-yellow-800 mb-4">🛍️ Flexible Expenses</h4>
                    <div class="grid md:grid-cols-2 gap-4">
                        <div>
                            <label for="food" class="block text-sm font-bold text-gray-700 mb-2">
                                🍔 Food (XAF)
                            </label>
                            <input type="number" id="food" name="food" min="0" required
                                class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-yellow-500 focus:ring-2 focus:ring-yellow-200 transition-all duration-300">
                        </div>
                        <div>
                            <label for="clothes" class="block text-sm font-bold text-gray-700 mb-2">
                                👕 Clothes (XAF)
                            </label>
                            <input type="number" id="clothes" name="clothes" min="0" required
                                class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-yellow-500 focus:ring-2 focus:ring-yellow-200 transition-all duration-300">
                        </div>
                        <div>
                            <label for="transport" class="block text-sm font-bold text-gray-700 mb-2">
                                🚗 Transport (XAF)
                            </label>
                            <input type="number" id="transport" name="transport" min="0" required
                                class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-yellow-500 focus:ring-2 focus:ring-yellow-200 transition-all duration-300">
                        </div>
                        <div>
                            <label for="leisure" class="block text-sm font-bold text-gray-700 mb-2">
                                🎮 Leisure (XAF)
                            </label>
                            <input type="number" id="leisure" name="leisure" min="0" required
                                class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-yellow-500 focus:ring-2 focus:ring-yellow-200 transition-all duration-300">
                        </div>
                        <div class="md:col-span-2">
                            <label for="other" class="block text-sm font-bold text-gray-700 mb-2">
                                📦 Other (XAF)
                            </label>
                            <input type="number" id="other" name="other" min="0" required
                                class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-yellow-500 focus:ring-2 focus:ring-yellow-200 transition-all duration-300">
                        </div>
                    </div>
                </div>

                <!-- Savings Goal -->
                <div class="bg-green-50 p-6 rounded-lg overflow-visible">
                    <label for="savingsGoal" class="block text-lg font-bold text-green-800 mb-2">
                        🎯 Monthly Savings Goal (XAF)
                    </label>
                    <input type="number" id="savingsGoal" name="savingsGoal" min="0" required
                        class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-green-500 focus:ring-2 focus:ring-green-200 transition-all duration-300 text-lg">
                </div>

                <!-- Generate Plan Button -->
                <button type="submit"
                    class="w-full bg-gradient-to-r from-purple-500 to-pink-500 hover:from-purple-600 hover:to-pink-600 text-white font-bold py-4 px-8 rounded-lg shadow-lg transform hover:scale-105 transition-all duration-300 text-xl">
                    🚀 Generate My Plan
                </button>
            </form>
        </div>
    </div>

    <!-- JavaScript for Dashboard Logic -->
    <script>
        // Financial tips for children
        const financialTips = [
            "💰 Save a little bit every day, and watch your money grow like a tree!",
            "🎯 Set a goal for something special you want to buy, then save for it!",
            "📊 Keep track of your spending by writing it down in a notebook.",
            "🛍️ Before buying something, ask yourself: 'Do I really need this?'",
            "🏦 Think of your savings like a superhero's energy - the more you have, the stronger you become!",
            "💡 Compare prices before buying - sometimes the same thing costs less elsewhere!",
            "🎮 Earn your spending money by doing chores or helping family members.",
            "📱 Apps and games might look fun, but check if they cost money first!",
            "🍔 Cooking at home is usually cheaper than buying food outside.",
            "🎁 Making gifts yourself can be more special and costs less money!"
        ];

        let currentUser = localStorage.getItem('currentUser');
        let tipInterval;

        // Check if user is logged in
        if (!currentUser) {
            alert('Please login first!');
            window.location.href = 'login.html';
        }

        // Display username
        document.getElementById('usernameDisplay').textContent = currentUser;

        // Format currency with thousand separators
        function formatCurrency(amount) {
            return new Intl.NumberFormat('en-US').format(amount) + ' XAF';
        }

        // Update budget overview boxes
        function updateBudgetOverview(data) {
            document.getElementById('totalIncome').textContent = formatCurrency(data.monthlyRevenue || 0);
            document.getElementById('totalCompulsory').textContent = formatCurrency(data.rent || 0);

            const flexibleTotal = (data.food || 0) + (data.clothes || 0) + (data.transport || 0) +
                (data.leisure || 0) + (data.other || 0);
            document.getElementById('totalFlexible').textContent = formatCurrency(flexibleTotal);

            // Change box colors based on financial health
            const income = data.monthlyRevenue || 0;
            const totalExpenses = (data.rent || 0) + flexibleTotal;

            if (income > 0 && totalExpenses > income * 0.8) {
                document.getElementById('flexibleBox').className = 'bg-gradient-to-br from-red-100 to-red-200 p-6 rounded-xl shadow-lg';
            }
        }

        // Display random financial tip
        function displayRandomTip() {
            const randomTip = financialTips[Math.floor(Math.random() * financialTips.length)];
            document.getElementById('dailyTip').textContent = randomTip;
        }

        // Start tip rotation every 20 seconds
        function startTipRotation() {
            displayRandomTip(); // Show first tip immediately
            tipInterval = setInterval(displayRandomTip, 20000);
        }

        // Load existing financial data
        function loadExistingData() {
            const financialData = JSON.parse(localStorage.getItem(`financialData_${currentUser}`) || '[]');

            if (financialData.length > 0) {
                const latestData = financialData[financialData.length - 1];

                // Populate form with existing data
                Object.keys(latestData).forEach(key => {
                    const element = document.getElementById(key);
                    if (element) {
                        element.value = latestData[key];
                    }
                });

                updateBudgetOverview(latestData);
            }
        }

        // Handle budget form submission
        document.getElementById('budgetForm').addEventListener('submit', function (e) {
            e.preventDefault();
            console.log('Form submitted!'); // Debug log

            // Get form data directly from elements
            const budgetData = getCurrentFormData();

            // Validate all fields are filled and positive
            const requiredFields = ['monthlyRevenue', 'rent', 'food', 'clothes', 'transport', 'leisure', 'other', 'savingsGoal'];
            for (let field of requiredFields) {
                if (budgetData[field] < 0) {
                    alert(`Please enter a positive number for ${field}! 💰`);
                    return;
                }
                if (!budgetData[field] && budgetData[field] !== 0) {
                    alert(`Please fill in all fields! Missing: ${field} 📝`);
                    return;
                }
            }

            // Calculate totals
            const totalExpenses = budgetData.rent + budgetData.food + budgetData.clothes +
                budgetData.transport + budgetData.leisure + budgetData.other;
            const flexibleExpenses = budgetData.food + budgetData.clothes + budgetData.transport +
                budgetData.leisure + budgetData.other;

            // Generate plan
            let plan = {};
            const remainingAfterExpenses = budgetData.monthlyRevenue - totalExpenses;

            if (remainingAfterExpenses < 0) {
                // Suggest reduction
                const reductionAmount = Math.abs(remainingAfterExpenses);
                const suggestedReduction = Math.min(flexibleExpenses * 0.2, reductionAmount);

                plan = {
                    status: 'deficit',
                    message: 'Your expenses are higher than your income! 😟',
                    suggestion: `Try reducing your flexible expenses by ${formatCurrency(suggestedReduction)} (about 20%)`,
                    recommendedSavings: Math.max(budgetData.monthlyRevenue * 0.1, 0)
                };
            } else {
                // Calculate potential savings
                const potentialSavings = remainingAfterExpenses;
                plan = {
                    status: 'surplus',
                    message: 'Great job! You have money left over! 🎉',
                    suggestion: `You can save ${formatCurrency(potentialSavings)} this month!`,
                    recommendedSavings: Math.min(budgetData.savingsGoal, potentialSavings)
                };
            }

            // Save data with plan
            try {
                const users = JSON.parse(localStorage.getItem('users') || '[]');
                console.log('Current users:', users); // Debug log
                console.log('Current user:', currentUser); // Debug log

                // Check if user exists in array
                const userExists = users.find(user => user.username === currentUser);
                if (!userExists) {
                    alert('User data not found! Please logout and login again.');
                    return;
                }

                const dataWithPlan = {
                    ...budgetData,
                    plan: plan,
                    createdDate: new Date().toISOString(),
                    username: currentUser
                };

                console.log('Saving data:', dataWithPlan); // Debug log

                // Save financial data separately with user-specific key
                const existingFinancialData = JSON.parse(localStorage.getItem(`financialData_${currentUser}`) || '[]');
                existingFinancialData.push(dataWithPlan);
                localStorage.setItem(`financialData_${currentUser}`, JSON.stringify(existingFinancialData));

                // Update overview
                updateBudgetOverview(budgetData);

                // Show success message and redirect
                alert('🎉 Your financial plan has been generated! Let\'s check it out!');
                window.location.href = 'savings-plan.html';
            } catch (error) {
                console.error('Error saving data:', error);
                alert('Error saving your data. Please try again!');
            }
        });

        // Logout functionality
        document.getElementById('logoutBtn').addEventListener('click', function () {
            if (confirm('Are you sure you want to logout? 👋')) {
                localStorage.removeItem('currentUser');
                clearInterval(tipInterval);
                window.location.href = 'index.html';
            }
        });

        // Initialize dashboard
        loadExistingData();
        startTipRotation();

        // Function to get current form values
        function getCurrentFormData() {
            return {
                monthlyRevenue: parseFloat(document.getElementById('monthlyRevenue').value) || 0,
                rent: parseFloat(document.getElementById('rent').value) || 0,
                food: parseFloat(document.getElementById('food').value) || 0,
                clothes: parseFloat(document.getElementById('clothes').value) || 0,
                transport: parseFloat(document.getElementById('transport').value) || 0,
                leisure: parseFloat(document.getElementById('leisure').value) || 0,
                other: parseFloat(document.getElementById('other').value) || 0,
                savingsGoal: parseFloat(document.getElementById('savingsGoal').value) || 0
            };
        }

        // Add form field animations and real-time updates
        document.querySelectorAll('input').forEach(input => {
            input.addEventListener('focus', function () {
                this.parentElement.classList.add('transform', 'scale-102');
            });

            input.addEventListener('blur', function () {
                this.parentElement.classList.remove('transform', 'scale-102');
            });

            // Add real-time update on input
            input.addEventListener('input', function () {
                const currentData = getCurrentFormData();
                updateBudgetOverview(currentData);
            });
        });
    </script>
</body>

</html>